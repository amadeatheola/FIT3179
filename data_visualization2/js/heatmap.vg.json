{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "title": "Correlation Heatmap of ASEAN Rice Metrics (2019â€“2022)",
  "data": {
    "url": "https://raw.githubusercontent.com/amadeatheola/FIT3179/main/data_visualization2/data/asean_rice_data.csv"
  },
  "transform": [
    {
      "fold": [
        "Production",
        "Total_Rice_Consumption",
        "Yield",
        "ExportQuantity",
        "ImportQuantity",
        "SelfSufficiencyRatio"
      ],
      "as": ["Metric1", "Value1"]
    },
    {
      "flatten": [
        "Production",
        "Total_Rice_Consumption",
        "Yield",
        "ExportQuantity",
        "ImportQuantity",
        "SelfSufficiencyRatio"
      ],
      "as": [
        "Metric2_Production",
        "Metric2_Total_Rice_Consumption",
        "Metric2_Yield",
        "Metric2_ExportQuantity",
        "Metric2_ImportQuantity",
        "Metric2_SelfSufficiencyRatio"
      ]
    },
    {
      "fold": [
        "Metric2_Production",
        "Metric2_Total_Rice_Consumption",
        "Metric2_Yield",
        "Metric2_ExportQuantity",
        "Metric2_ImportQuantity",
        "Metric2_SelfSufficiencyRatio"
      ],
      "as": ["Metric2", "Value2"]
    },
    {"filter": "datum.Metric1 != datum.Metric2"},
    {
      "aggregate": [
        {"op": "mean", "field": "Value1", "as": "mean1"},
        {"op": "mean", "field": "Value2", "as": "mean2"},
        {"op": "stdev", "field": "Value1", "as": "sd1"},
        {"op": "stdev", "field": "Value2", "as": "sd2"},
        {"op": "covariance", "field": "Value1", "as": "cov"}
      ],
      "groupby": ["Metric1", "Metric2"]
    },
    {
      "calculate": "datum.cov / (datum.sd1 * datum.sd2)",
      "as": "Correlation"
    }
  ],
  "mark": "rect",
  "encoding": {
    "x": {"field": "Metric1", "type": "nominal", "title": null, "axis": {"labelAngle": 45}},
    "y": {"field": "Metric2", "type": "nominal", "title": null},
    "color": {
      "field": "Correlation",
      "type": "quantitative",
      "title": "Correlation",
      "scale": {"domain": [-1, 1], "scheme": "redblue"}
    },
    "tooltip": [
      {"field": "Metric1", "type": "nominal"},
      {"field": "Metric2", "type": "nominal"},
      {"field": "Correlation", "type": "quantitative", "format": ".2f"}
    ]
  },
  "config": {
    "view": {"stroke": "transparent"},
    "axis": {"grid": false}
  }
}